{"version":3,"sources":["components/x_axis.jsx"],"names":[],"mappings":";;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;;;;;;;;;;;IAEqB,K;;;AACnB,iBAAY,KAAZ,EAAmB;AAAA;;AAAA,yFACX,KADW;;AAGjB,UAAK,KAAL,GAAa;AACX,wBAAkB;AADP,KAAb;AAHiB;AAMlB;;;;8CAEyB,S,EAAW;AACnC,UAAG,KAAK,KAAL,CAAW,SAAX,IAAwB,UAAU,SAArC,EAAgD;AAC9C,YAAG,UAAU,SAAb,EAAwB;AACtB,cAAI,QAAQ,KAAK,KAAL,CAAW,aAAX,IAA4B,IAAxC;AACA,eAAK,QAAL,GAAgB,YAAY,KAAK,IAAL,CAAU,IAAV,CAAe,IAAf,CAAZ,EAAkC,KAAlC,CAAhB;AACD,SAHD,MAGO;AACL,wBAAc,KAAK,QAAnB;AACD;AACF;;AAED,UAAG,CAAC,qBAAE,OAAF,CAAU,UAAU,KAApB,EAA2B,KAAK,KAAL,CAAW,KAAtC,CAAJ,EAAkD;AAChD,aAAK,QAAL,CAAc,EAAE,kBAAkB,EAApB,EAAd;AACD;AACF;;;2CAEsB;AACrB,oBAAc,KAAK,QAAnB;AACD;;;oCAEe;AACd,UAAG,KAAK,KAAL,CAAW,QAAd,EAAwB,OAAO,EAAP;AACxB,aAAO,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAK,KAAL,CAAW,KAAX,GAAmB,KAAK,KAAL,CAAW,MAAX,GAAkB,CAArC,GAAyC,KAAK,aAAL,EAAhD;AACD;;;4BAEO;AACN,aAAO,qBAAe,SAAf,CAAyB,KAAK,KAAL,CAAW,KAApC,EAA2C,KAAK,KAAL,EAA3C,CAAP;AACD;;;6BAEQ;AACP,UAAI,QAAQ,KAAK,KAAL,EAAZ;AACA,aAAO;AACL,aAAK,MAAM,GAAN,EADA;AAEL,aAAK,MAAM,GAAN;AAFA,OAAP;AAID;;;6BAEQ;AAAA;;AACP,oEACiB,KAAK,KAAL,CAAW,KAAX,CAAiB,CAAjB,CADjB,+CAEiB,KAAK,KAAL,CAAW,KAAX,CAAiB,CAAjB,CAFjB,oCAGW,mBAAY;AACnB,eAAO,CAAC,0BAAD,EAAoB,0BAApB,EAAuC,IAAvC,EAAP;AACD,OALH;AAOD;;;+BAEU,O,EAAS;AAClB,aAAO,KAAK,KAAL,GAAa,WAAb,CAAyB,KAAK,MAAL,GAAc,OAAd,CAAzB,CAAP;AACD;;;kCAEa,I,EAAM;AAClB,WAAK,WAAL,uBAA8B,IAA9B;AACD;;;gCAEW,O,EAAS,I,EAAM;AACzB,UAAI,SAAS,KAAK,MAAL,EAAb;AACA,aAAO,OAAP,IAAkB,KAAK,KAAvB;;AAEA,WAAK,KAAL,CAAW,aAAX,CAAyB,OAAO,OAAP,EAAzB;AACD;;;2BAEM;AACL,UAAI,kBAAkB,KAAK,UAAL,uBAA6B,KAAnD;AACA,UAAI,mBAAmB,KAAK,KAAL,GAAa,QAAb,CAAsB,eAAtB,CAAvB;AACA,UAAI,eAAe,KAAK,MAAL,GAAc,GAAd,CAAkB,KAArC;AACA,UAAI,0BAAJ;;AAEA,UAAG,KAAK,KAAL,CAAW,KAAd,EAAqB;AACnB,4BAAoB,KAAK,KAAL,GAAa,MAAb,CAAoB,KAAK,UAAL,uBAA6B,KAAjD,CAApB;AACD;;AAED,UAAG,mBAAmB,YAAnB,IACA,KAAK,KAAL,CAAW,KAAX,IAAoB,mBAAmB,kBAAkB,KAD5D,EACoE;AAChE,aAAK,aAAL,CAAmB,KAAK,MAAL,GAAc,GAAjC;AAEH,OAJD,MAIO;AACL,YAAG,EAAE,KAAK,KAAL,CAAW,KAAX,IAAoB,iBAAiB,KAAjB,IAA0B,YAAhD,CAAH,EAAkE;AAChE,eAAK,aAAL,CAAmB,gBAAnB;AACD;;AAED,YAAG,iBAAiB,KAAjB,IAA0B,YAA1B,IACA,KAAK,KAAL,CAAW,KAAX,IAAoB,iBAAiB,KAAjB,IAA0B,kBAAkB,KADnE,EAC2E;AACvE,wBAAc,KAAK,QAAnB;AACA,eAAK,KAAL,CAAW,MAAX;AACH;AACF;AACF;;;mCAEc,O,EAAS,C,EAAG;AAAA;;AACzB,UAAI,SAAS,KAAK,MAAL,EAAb;AACA,aAAO,OAAP,IAAkB,KAAK,KAAL,GAAa,UAAb,CAAwB,CAAxB,EAA2B,KAA7C;AACA,WAAK,QAAL,CAAc;AACZ,0BAAkB;AADN,OAAd,EAEG,YAAM;AACP,eAAK,KAAL,CAAW,aAAX,CAAyB,OAAO,OAAP,EAAzB;AACD,OAJD;AAKD;;;uCAEkB,O,EAAS,C,EAAG;AAC7B,UAAI,YAAY,KAAK,KAAL,CAAW,gBAA3B;AACA,gBAAU,OAAV,IAAqB,CAArB;AACA,WAAK,QAAL,CAAc;AACZ,0BAAkB;AADN,OAAd;AAGD;;;uCAEkB,O,EAAS;AAC1B,UAAI,aAAa,KAAK,UAAL,CAAgB,OAAhB,CAAjB;AACA,UAAG,qBAAE,QAAF,CAAW,KAAK,KAAL,CAAW,gBAAX,CAA4B,OAA5B,CAAX,CAAH,EAAqD;AACnD,eAAO,KAAK,KAAL,CAAW,gBAAX,CAA4B,OAA5B,CAAP;AACD,OAFD,MAEO,IAAG,UAAH,EAAe;AACpB,eAAO,WAAW,CAAlB;AACD;AACF;;;uCAEkB,O,EAAS,C,EAAG;AAC7B,UAAI,kBAAkB,KAAK,kBAAL,CAAwB,OAAxB,CAAtB;AACA,aAAO,KAAK,GAAL,CAAS,kBAAkB,CAA3B,CAAP;AACD;;;sCAEiB,C,EAAG;AACnB,UAAG,KAAK,kBAAL,uBAAqC,CAArC,IAA0C,KAAK,kBAAL,uBAAqC,CAArC,CAA7C,EAAsF;AACpF;AACD,OAFD,MAEO;AACL;AACD;AACF;;;sCAEiB,C,EAAG;AACnB,aAAO,KAAK,kBAAL,uBAAqC,CAArC,KAA2C,CAA3C,IACA,KAAK,kBAAL,uBAAqC,CAArC,KAA2C,CADlD;AAED;;;oCAEe,I,EAAM;AACpB,UAAG,KAAK,KAAL,CAAW,KAAd,EAAqB;AACnB,YAAG,CAAC,KAAK,iBAAL,CAAuB,KAAK,CAA5B,CAAJ,EAAoC;AAClC,cAAI,UAAU,KAAK,iBAAL,CAAuB,KAAK,CAA5B,CAAd;AACA,eAAK,WAAL,CAAiB,OAAjB,EAA0B,IAA1B;AACD;AACF,OALD,MAKO;AACL,aAAK,aAAL,CAAmB,IAAnB;AACD;AACF;;;0CAEqB;AACpB,UAAG,KAAK,KAAL,CAAW,KAAd,EAAqB;AACnB,eACE;AAAA;UAAA;UACE;AACE,gBAAI,KAAK,kBAAL,sBADN;AAEE,gBAAI,KAAK,kBAAL,sBAFN,GADF;UAIE,mDAAS,OAAO,KAAK,KAAL,EAAhB;AACE,oBAAQ,KAAK,MAAL,EADV;AAEE,wBAAY,KAAK,UAAL,sBAFd;AAGE,oBAAQ,KAAK,kBAAL,CAAwB,IAAxB,CAA6B,IAA7B,uBAHV;AAIE,qBAAS,KAAK,cAAL,CAAoB,IAApB,CAAyB,IAAzB,uBAJX;AAJF,SADF;AAYD;AACF;;;6BAEQ;AACP,UAAI,SAAS,KAAK,KAAL,CAAW,MAAxB;;AAEA,aACE;AAAA;QAAA,EAAG,WAAU,OAAb,EAAqB,2BAAyB,SAAO,CAAP,GAAS,KAAK,aAAL,EAAlC,WAA2D,MAA3D,OAArB;QACE;AACE,uBAAa,KAAK,KAAL,CAAW,WAD1B;AAEE,iBAAO,KAAK,KAAL,EAFT;AAGE,mBAAS,KAAK,eAAL,CAAqB,IAArB,CAA0B,IAA1B,CAHX,GADF;QAKG,KAAK,mBAAL,EALH;QAME,mDAAS,OAAO,KAAK,KAAL,EAAhB;AACE,kBAAQ,KAAK,MAAL,EADV;AAEE,sBAAY,KAAK,UAAL,sBAFd;AAGE,kBAAQ,KAAK,kBAAL,CAAwB,IAAxB,CAA6B,IAA7B,uBAHV;AAIE,mBAAS,KAAK,cAAL,CAAoB,IAApB,CAAyB,IAAzB,uBAJX;AANF,OADF;AAcD;;;;EA/LgC,gBAAM,S;;kBAApB,K;AAgMpB;;AAED,MAAM,YAAN,GAAqB;AACnB,UAAQ;AADW,CAArB","file":"x_axis.js","sourcesContent":["import React from 'react';\nimport { G, Circle } from './react_svg';\nimport { TickCollection } from '../tick';\nimport TickCollectionView from './tick_collection';\nimport Handler from './handler';\nimport { HANDLER_ONE, HANDLER_TWO } from './handler';\nimport LineBetweenHandlers from './line_between_handlers';\nimport _ from 'underscore';\n\nexport default class XAxis extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      handlersPosition: []\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if(this.props.isPlaying != nextProps.isPlaying) {\n      if(nextProps.isPlaying) {\n        let speed = this.props.playStopSpeed || 1000;\n        this.interval = setInterval(this.move.bind(this), speed);\n      } else {\n        clearInterval(this.interval);\n      }\n    }\n\n    if(!_.isEqual(nextProps.multi, this.props.multi)) {\n      this.setState({ handlersPosition: [] });\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  playStopSpace() {\n    if(this.props.playStop) return 50;\n    return 0;\n  }\n\n  width() {\n    return this.props.width - this.props.margin*4 - this.playStopSpace();\n  }\n\n  ticks() {\n    return TickCollection.fromRange(this.props.range, this.width());\n  }\n\n  limits() {\n    let ticks = this.ticks();\n    return {\n      min: ticks.min(),\n      max: ticks.max()\n    };\n  }\n\n  values() {\n    return {\n      [HANDLER_ONE]: this.props.value[0],\n      [HANDLER_TWO]: this.props.value[1],\n      toArray: function () {\n        return [this[HANDLER_ONE], this[HANDLER_TWO]].sort();\n      }\n    };\n  }\n\n  activeTick(handler) {\n    return this.ticks().findByValue(this.values()[handler]);\n  }\n\n  moveHandlerTo(tick) {\n    this.moveHandler(HANDLER_ONE, tick);\n  }\n\n  moveHandler(handler, tick) {\n    let values = this.values();\n    values[handler] = tick.value;\n\n    this.props.onValueChange(values.toArray());\n  }\n\n  move() {\n    let activeTickValue = this.activeTick(HANDLER_ONE).value;\n    let tickNextToActive = this.ticks().findNext(activeTickValue);\n    let maxTickValue = this.limits().max.value;\n    let beforeLastHandler;\n\n    if(this.props.multi) {\n      beforeLastHandler = this.ticks().before(this.activeTick(HANDLER_TWO).value);\n    }\n\n    if(activeTickValue == maxTickValue ||\n      (this.props.multi && activeTickValue == beforeLastHandler.value)) {\n        this.moveHandlerTo(this.limits().min);\n\n    } else {\n      if(!(this.props.multi && tickNextToActive.value == maxTickValue)) {\n        this.moveHandlerTo(tickNextToActive);\n      }\n\n      if(tickNextToActive.value == maxTickValue ||\n        (this.props.multi && tickNextToActive.value == beforeLastHandler.value)) {\n          clearInterval(this.interval);\n          this.props.onStop();\n      }\n    }\n  }\n\n  handlerDragged(handler, x) {\n    let values = this.values();\n    values[handler] = this.ticks().findCloser(x).value;\n    this.setState({\n      handlersPosition: []\n    }, () => {\n      this.props.onValueChange(values.toArray());\n    });\n  }\n\n  setHandlerPosition(handler, x) {\n    let positions = this.state.handlersPosition;\n    positions[handler] = x;\n    this.setState({\n      handlersPosition: positions\n    });\n  }\n\n  getHandlerPosition(handler) {\n    let activeTick = this.activeTick(handler);\n    if(_.isNumber(this.state.handlersPosition[handler])) {\n      return this.state.handlersPosition[handler];\n    } else if(activeTick) {\n      return activeTick.x;\n    }\n  }\n\n  getHandlerDistance(handler, x) {\n    let handlerPosition = this.getHandlerPosition(handler);\n    return Math.abs(handlerPosition - x);\n  }\n\n  findCloserHandler(x) {\n    if(this.getHandlerDistance(HANDLER_ONE, x) > this.getHandlerDistance(HANDLER_TWO, x)) {\n      return HANDLER_TWO;\n    } else {\n      return HANDLER_ONE;\n    }\n  }\n\n  thereIsAHandlerOn(x) {\n    return this.getHandlerDistance(HANDLER_ONE, x) == 0 ||\n           this.getHandlerDistance(HANDLER_TWO, x) == 0;\n  }\n\n  handleTickClick(tick) {\n    if(this.props.multi) {\n      if(!this.thereIsAHandlerOn(tick.x)) {\n        let handler = this.findCloserHandler(tick.x);\n        this.moveHandler(handler, tick);\n      }\n    } else {\n      this.moveHandlerTo(tick);\n    }\n  }\n\n  multiHandlerSupport() {\n    if(this.props.multi) {\n      return (\n        <G>\n          <LineBetweenHandlers\n            x1={this.getHandlerPosition(HANDLER_ONE)}\n            x2={this.getHandlerPosition(HANDLER_TWO)} />\n          <Handler ticks={this.ticks()}\n            limits={this.limits()}\n            activeTick={this.activeTick(HANDLER_TWO)}\n            onDrag={this.setHandlerPosition.bind(this, HANDLER_TWO)}\n            dragged={this.handlerDragged.bind(this, HANDLER_TWO)}/>\n        </G>\n      );\n    }\n  }\n\n  render() {\n    let margin = this.props.margin;\n\n    return (\n      <G className=\"xaxis\" transform={ `translate(${margin*2+this.playStopSpace()}, ${margin}) ` }>\n        <TickCollectionView\n          contextSize={this.props.contextSize}\n          ticks={this.ticks()}\n          onClick={this.handleTickClick.bind(this)}/>\n        {this.multiHandlerSupport()}\n        <Handler ticks={this.ticks()}\n          limits={this.limits()}\n          activeTick={this.activeTick(HANDLER_ONE)}\n          onDrag={this.setHandlerPosition.bind(this, HANDLER_ONE)}\n          dragged={this.handlerDragged.bind(this, HANDLER_ONE)}/>\n      </G>\n    );\n  }\n};\n\nXAxis.defaultProps = {\n  margin: 18\n};\n"]}