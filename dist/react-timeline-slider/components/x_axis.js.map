{"version":3,"sources":["components/x_axis.jsx"],"names":[],"mappings":"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","file":"x_axis.js","sourcesContent":["import React from 'react';\nimport { G, Circle } from './react_svg';\nimport { TickCollection } from '../tick';\nimport TickCollectionView from './tick_collection';\nimport Handler from './handler';\nimport { HANDLER_ONE, HANDLER_TWO } from './handler';\nimport LineBetweenHandlers from './line_between_handlers';\nimport _ from 'underscore';\n\nexport default class XAxis extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      handlersPosition: []\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if(this.props.isPlaying != nextProps.isPlaying) {\n      if(nextProps.isPlaying) {\n        let speed = this.props.playStopSpeed || 1000;\n        this.interval = setInterval(this.move.bind(this), speed);\n      } else {\n        clearInterval(this.interval);\n      }\n    }\n\n    if(!_.isEqual(nextProps.multi, this.props.multi)) {\n      this.setState({ handlersPosition: [] });\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  playStopSpace() {\n    if(this.props.playStop) return 50;\n    return 0;\n  }\n\n  width() {\n    return this.props.width - this.props.margin*4 - this.playStopSpace();\n  }\n\n  ticks() {\n    return TickCollection.fromRange(this.props.range, this.width());\n  }\n\n  limits() {\n    let ticks = this.ticks();\n    return {\n      min: ticks.min(),\n      max: ticks.max()\n    };\n  }\n\n  values() {\n    return {\n      [HANDLER_ONE]: this.props.value[0],\n      [HANDLER_TWO]: this.props.value[1],\n      toArray: function () {\n        return [this[HANDLER_ONE], this[HANDLER_TWO]].sort();\n      }\n    };\n  }\n\n  activeTick(handler) {\n    return this.ticks().findByValue(this.values()[handler]);\n  }\n\n  moveHandlerTo(tick) {\n    this.moveHandler(HANDLER_ONE, tick);\n  }\n\n  moveHandler(handler, tick) {\n    let values = this.values();\n    values[handler] = tick.value;\n\n    this.props.onValueChange(values.toArray());\n  }\n\n  move() {\n    let activeTickValue = this.activeTick(HANDLER_ONE).value;\n    let tickNextToActive = this.ticks().findNext(activeTickValue);\n    let maxTickValue = this.limits().max.value;\n    let beforeLastHandler;\n\n    if(this.props.multi) {\n      beforeLastHandler = this.ticks().before(this.activeTick(HANDLER_TWO).value);\n    }\n\n    if(activeTickValue == maxTickValue ||\n      (this.props.multi && activeTickValue == beforeLastHandler.value)) {\n        this.moveHandlerTo(this.limits().min);\n\n    } else {\n      if(!(this.props.multi && tickNextToActive.value == maxTickValue)) {\n        this.moveHandlerTo(tickNextToActive);\n      }\n\n      if(tickNextToActive.value == maxTickValue ||\n        (this.props.multi && tickNextToActive.value == beforeLastHandler.value)) {\n          clearInterval(this.interval);\n          this.props.onStop();\n      }\n    }\n  }\n\n  handlerDragged(handler, x) {\n    let values = this.values();\n    values[handler] = this.ticks().findCloser(x).value;\n    this.setState({\n      handlersPosition: []\n    }, () => {\n      this.props.onValueChange(values.toArray());\n    });\n  }\n\n  setHandlerPosition(handler, x) {\n    let positions = this.state.handlersPosition;\n    positions[handler] = x;\n    this.setState({\n      handlersPosition: positions\n    });\n  }\n\n  getHandlerPosition(handler) {\n    let activeTick = this.activeTick(handler);\n    if(_.isNumber(this.state.handlersPosition[handler])) {\n      return this.state.handlersPosition[handler];\n    } else if(activeTick) {\n      return activeTick.x;\n    }\n  }\n\n  getHandlerDistance(handler, x) {\n    let handlerPosition = this.getHandlerPosition(handler);\n    return Math.abs(handlerPosition - x);\n  }\n\n  findCloserHandler(x) {\n    if(this.getHandlerDistance(HANDLER_ONE, x) > this.getHandlerDistance(HANDLER_TWO, x)) {\n      return HANDLER_TWO;\n    } else {\n      return HANDLER_ONE;\n    }\n  }\n\n  thereIsAHandlerOn(x) {\n    return this.getHandlerDistance(HANDLER_ONE, x) == 0 ||\n           this.getHandlerDistance(HANDLER_TWO, x) == 0;\n  }\n\n  handleTickClick(tick) {\n    if(this.props.multi) {\n      if(!this.thereIsAHandlerOn(tick.x)) {\n        let handler = this.findCloserHandler(tick.x);\n        this.moveHandler(handler, tick);\n      }\n    } else {\n      this.moveHandlerTo(tick);\n    }\n  }\n\n  multiHandlerSupport() {\n    if(this.props.multi) {\n      return (\n        <G>\n          <LineBetweenHandlers\n            x1={this.getHandlerPosition(HANDLER_ONE)}\n            x2={this.getHandlerPosition(HANDLER_TWO)} />\n          <Handler ticks={this.ticks()}\n            limits={this.limits()}\n            activeTick={this.activeTick(HANDLER_TWO)}\n            onDrag={this.setHandlerPosition.bind(this, HANDLER_TWO)}\n            dragged={this.handlerDragged.bind(this, HANDLER_TWO)}/>\n        </G>\n      );\n    }\n  }\n\n  render() {\n    let margin = this.props.margin;\n\n    return (\n      <G className=\"xaxis\" transform={ `translate(${margin*2+this.playStopSpace()}, ${margin}) ` }>\n        <TickCollectionView\n          contextSize={this.props.contextSize}\n          ticks={this.ticks()}\n          onClick={this.handleTickClick.bind(this)}/>\n        {this.multiHandlerSupport()}\n        <Handler ticks={this.ticks()}\n          limits={this.limits()}\n          activeTick={this.activeTick(HANDLER_ONE)}\n          onDrag={this.setHandlerPosition.bind(this, HANDLER_ONE)}\n          dragged={this.handlerDragged.bind(this, HANDLER_ONE)}/>\n      </G>\n    );\n  }\n};\n\nXAxis.defaultProps = {\n  margin: 18\n};\n"]}